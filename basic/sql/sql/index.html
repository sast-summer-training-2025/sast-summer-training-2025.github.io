
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../python/python/">
      
      
        <link rel="next" href="../../../frontend/index_frontend/">
      
      
      <link rel="icon" href="../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>课程讲义 - 酒井科协暑培 2025</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sql" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="酒井科协暑培 2025" class="md-header__button md-logo" aria-label="酒井科协暑培 2025" data-md-component="logo">
      
  <img src="../../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            酒井科协暑培 2025
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              课程讲义
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/sast-summer-training-2025/sast-summer-training-2025.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    SAST Summer Training 2025
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  首页

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../index_basic/" class="md-tabs__link">
          
  
  
    
  
  基础

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../frontend/index_frontend/" class="md-tabs__link">
          
  
  
    
  
  前端

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../backend/index_backend/" class="md-tabs__link">
          
  
  
    
  
  后端

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../unity/index_unity/" class="md-tabs__link">
          
  
  
    
  
  游戏

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ai/index_ai/" class="md-tabs__link">
          
  
  
    
  
  AI

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="酒井科协暑培 2025" class="md-nav__button md-logo" aria-label="酒井科协暑培 2025" data-md-component="logo">
      
  <img src="../../../images/logo.png" alt="logo">

    </a>
    酒井科协暑培 2025
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sast-summer-training-2025/sast-summer-training-2025.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    SAST Summer Training 2025
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            首页
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../links/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    资源链接
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index_basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基础 Track
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/index_frontend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    前端 Track
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/index_backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    后端 Track
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../unity/index_unity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    游戏 Track
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/index_ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AI Track
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    基础
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index_basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基础 Track
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux & Git
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Linux & Git
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux%26git/Linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux%26git/Git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux%26git/Extend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    拓展资料
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux%26git/ShellOperations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基本操作(部分)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.bilibili.com/video/BV1Hh81z9EM5/?spm_id_from=333.337.search-card.all.click&vd_source=a909320ea634844e50442d666d7b77c7" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux 课程回放
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.bilibili.com/video/BV1Hh81z9EG2/?spm_id_from=333.337.search-card.all.click&vd_source=a909320ea634844e50442d666d7b77c7" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git 课程回放
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/prepare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课前准备
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程讲义
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.bilibili.com/video/BV1TfhbzsEVQ/?share_source=copy_web&vd_source=5f41358f46c6dc60e03c3ff6ca5a8520" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程回放
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    数据库 & SQL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            数据库 & SQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    课程讲义
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    课程讲义
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      课程概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="课程概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      数据库
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      关系型数据库
    </span>
  </a>
  
    <nav class="md-nav" aria-label="关系型数据库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      理解关系型数据库的“关系”
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nosql" class="md-nav__link">
    <span class="md-ellipsis">
      非关系型数据库（NoSQL）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="非关系型数据库（NoSQL）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      关系型数据库与非关系型数据库的主要区别
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql_1" class="md-nav__link">
    <span class="md-ellipsis">
      SQL 入门
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL 入门">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      基本概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      数据类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      主键、外键和索引
    </span>
  </a>
  
    <nav class="md-nav" aria-label="主键、外键和索引">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary-key" class="md-nav__link">
    <span class="md-ellipsis">
      主键（Primary Key）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreign-key" class="md-nav__link">
    <span class="md-ellipsis">
      外键（Foreign Key）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      索引（Index）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      数据库和数据表操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据库和数据表操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      前期准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      数据库相关
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      表相关
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crud" class="md-nav__link">
    <span class="md-ellipsis">
      CRUD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CRUD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    <span class="md-ellipsis">
      INSERT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      UPDATE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    <span class="md-ellipsis">
      SELECT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SELECT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic" class="md-nav__link">
    <span class="md-ellipsis">
      BASIC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    <span class="md-ellipsis">
      WHERE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#and-or-not" class="md-nav__link">
    <span class="md-ellipsis">
      AND, OR, NOT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#null" class="md-nav__link">
    <span class="md-ellipsis">
      NULL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" class="md-nav__link">
    <span class="md-ellipsis">
      IN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#like" class="md-nav__link">
    <span class="md-ellipsis">
      LIKE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case" class="md-nav__link">
    <span class="md-ellipsis">
      CASE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operation-on-date" class="md-nav__link">
    <span class="md-ellipsis">
      OPERATION ON DATE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distinct" class="md-nav__link">
    <span class="md-ellipsis">
      DISTINCT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-by-limit" class="md-nav__link">
    <span class="md-ellipsis">
      ORDER BY &amp; Limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union" class="md-nav__link">
    <span class="md-ellipsis">
      UNION
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#joins-and-subqueries" class="md-nav__link">
    <span class="md-ellipsis">
      Joins and Subqueries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregates" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic_1" class="md-nav__link">
    <span class="md-ellipsis">
      BASIC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-by" class="md-nav__link">
    <span class="md-ellipsis">
      GROUP BY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" class="md-nav__link">
    <span class="md-ellipsis">
      HAVING
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ctes" class="md-nav__link">
    <span class="md-ellipsis">
      CTEs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-about" class="md-nav__link">
    <span class="md-ellipsis">
      More About
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explain" class="md-nav__link">
    <span class="md-ellipsis">
      EXPLAIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orm" class="md-nav__link">
    <span class="md-ellipsis">
      ORM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#orm_1" class="md-nav__link">
    <span class="md-ellipsis">
      常见 ORM 使用示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql_2" class="md-nav__link">
    <span class="md-ellipsis">
      SQL 注入
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL 注入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      基本原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      预防措施
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      参考资料
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.bilibili.com/video/BV1FgtnzVEXF/?share_source=copy_web&vd_source=5f41358f46c6dc60e03c3ff6ca5a8520" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程回放
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    前端
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            前端
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/index_frontend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    前端 Track
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/java/Environment_Setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课前准备
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/java/Java_introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程讲义
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程回放
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    后端
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            后端
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/index_backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    后端 Track
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Django
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Django
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/django/prepare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课前准备
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/django/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程讲义
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/sast-summer-training-2025/django-demo" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    演示代码
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/docker/prepare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课前准备
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/docker/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程讲义
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/docker/homework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程作业
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Rust
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Rust
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/rust/handout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程讲义
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程回放
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    游戏
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            游戏
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../unity/index_unity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    游戏 Track
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            AI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai/index_ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AI Track
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      课程概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="课程概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      数据库
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      关系型数据库
    </span>
  </a>
  
    <nav class="md-nav" aria-label="关系型数据库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      理解关系型数据库的“关系”
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nosql" class="md-nav__link">
    <span class="md-ellipsis">
      非关系型数据库（NoSQL）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="非关系型数据库（NoSQL）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      关系型数据库与非关系型数据库的主要区别
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql_1" class="md-nav__link">
    <span class="md-ellipsis">
      SQL 入门
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL 入门">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      基本概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      数据类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      主键、外键和索引
    </span>
  </a>
  
    <nav class="md-nav" aria-label="主键、外键和索引">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary-key" class="md-nav__link">
    <span class="md-ellipsis">
      主键（Primary Key）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreign-key" class="md-nav__link">
    <span class="md-ellipsis">
      外键（Foreign Key）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      索引（Index）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      数据库和数据表操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据库和数据表操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      前期准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      数据库相关
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      表相关
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crud" class="md-nav__link">
    <span class="md-ellipsis">
      CRUD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CRUD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    <span class="md-ellipsis">
      INSERT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      UPDATE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    <span class="md-ellipsis">
      SELECT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SELECT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic" class="md-nav__link">
    <span class="md-ellipsis">
      BASIC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    <span class="md-ellipsis">
      WHERE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#and-or-not" class="md-nav__link">
    <span class="md-ellipsis">
      AND, OR, NOT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#null" class="md-nav__link">
    <span class="md-ellipsis">
      NULL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" class="md-nav__link">
    <span class="md-ellipsis">
      IN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#like" class="md-nav__link">
    <span class="md-ellipsis">
      LIKE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case" class="md-nav__link">
    <span class="md-ellipsis">
      CASE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operation-on-date" class="md-nav__link">
    <span class="md-ellipsis">
      OPERATION ON DATE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distinct" class="md-nav__link">
    <span class="md-ellipsis">
      DISTINCT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-by-limit" class="md-nav__link">
    <span class="md-ellipsis">
      ORDER BY &amp; Limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union" class="md-nav__link">
    <span class="md-ellipsis">
      UNION
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#joins-and-subqueries" class="md-nav__link">
    <span class="md-ellipsis">
      Joins and Subqueries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregates" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic_1" class="md-nav__link">
    <span class="md-ellipsis">
      BASIC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-by" class="md-nav__link">
    <span class="md-ellipsis">
      GROUP BY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" class="md-nav__link">
    <span class="md-ellipsis">
      HAVING
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ctes" class="md-nav__link">
    <span class="md-ellipsis">
      CTEs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-about" class="md-nav__link">
    <span class="md-ellipsis">
      More About
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explain" class="md-nav__link">
    <span class="md-ellipsis">
      EXPLAIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orm" class="md-nav__link">
    <span class="md-ellipsis">
      ORM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#orm_1" class="md-nav__link">
    <span class="md-ellipsis">
      常见 ORM 使用示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql_2" class="md-nav__link">
    <span class="md-ellipsis">
      SQL 注入
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL 注入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      基本原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      预防措施
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      参考资料
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
    
                  


  
  


<h1 id="sql">数据库 &amp; SQL<a class="headerlink" href="#sql" title="Permanent link">&para;</a></h1>
<h2 id="_1">课程概述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="_2">数据库<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>为什么需要数据库？在日常生活中，我们经常会遇到各种需要存储和处理数据的场景。一所大学需要维护自己学校各个院系、人员和课程的各项信息；一个实验项目可能会面临存储时间、温度、转化率等各项实验过程指标和数据的需求；一个大模型的训练，也需要用到海量的训练数据。</p>
<p>不同的数据类型和应用场景，导向了不同的数据存储方式。小到一个文本文件、表格文件，大到一个专门存储数据的服务器，在开发和生产环境中，我们有很多类似的工具来帮助我们方便高效地存储、读取和处理数据，数据库就是其中的一种解决方案。</p>
<p>数据库相比于普通的文件或表格工具，具备以下优势：</p>
<ul>
<li><strong>高效的数据检索和查询</strong>：数据库支持复杂的查询语句，可以快速从大量数据中筛选出需要的信息，而不是像文本文件那样只能逐行查找。</li>
<li><strong>数据一致性和完整性保障</strong>：通过主键、外键、约束等机制，数据库可以保证数据的准确性和一致性，避免重复或错误的数据。</li>
<li><strong>并发访问和权限控制</strong>：数据库允许多个用户同时访问和操作数据，并能通过权限管理控制不同用户的访问范围，保证数据安全。</li>
<li><strong>事务支持</strong>：数据库支持事务操作，能够保证一组操作要么全部成功、要么全部失败，防止数据出现中间状态。</li>
<li><strong>可扩展性和备份恢复</strong>：数据库可以方便地扩展存储容量，并支持数据的备份与恢复，降低数据丢失风险。</li>
</ul>
<p>因此，数据库不仅能高效地存储和管理大量结构化数据，还能提供数据安全、完整性和高并发等特性，对于处理工程级别、企业规模的数据具有极好的优势，已经是现代信息系统不可或缺的基础组件。</p>
<h3 id="_3">关系型数据库<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>所谓“数据库”是以一定方式储存在一起、能予多个用户共享、具有尽可能小的冗余度、与应用程序彼此独立的数据集合。应用程序只需调用数据库软件提供的 API 接口便可以实现数据的读写，而无需在意数据在文件中如何存储以及如何索引。同学们可在“数据库系统概论”课程深入学习数据的存储方式与检索方式。</p>
<p>根据数据模型进行分类，可以将数据库分为：</p>
<ul>
<li><strong>关系型数据库</strong>，包括 <a href="https://www.mysql.com/">MySQL</a>、<a href="https://www.postgresql.org">PostgreSQL</a>、<a href="https://www.sqlite.org/">SQLite</a>、<a href="https://www.oracle.com/database/">Oracle</a> 等；</li>
<li><strong>非关系型数据库（NoSQL）</strong>，包括 <a href="https://www.mongodb.com/">MongoDB</a>、<a href="https://redis.io/">Redis</a>、<a href="https://cassandra.apache.org/">Apache Cassandra</a> 等。</li>
</ul>
<p>什么是关系型数据库？我们可以类比 Excel 表格：Excel 表格使用列表示属性、行表示不同的实例，而关系型数据库与之很相似，关系型数据库使用表（Table）来存储数据，其中：</p>
<ul>
<li>每一行代表一条<strong>记录（Record）</strong>，也就是一条完整的数据；</li>
<li>每一列代表一个<strong>字段（Field）</strong>，代表一条记录的某个属性。</li>
</ul>
<p>与 Excel 不同的是，关系型数据库通过关系（Relations）将不同表中的数据连接起来，使得用户可以更方便地进行数据查询和操作。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<h4 id="_4">理解关系型数据库的“关系”<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>关系型数据库中的“关系”是指表与表之间的连接或关联。这种关系通过特定的键（Key）来实现，主要包括以下几种类型：</p>
<ul>
<li>
<p><strong>一对一关系（One-to-One Relationship）</strong>：学生表与学号表的关系。</p>
</li>
<li>
<p><strong>一对多关系（One-to-Many Relationship）</strong>：学生表与院系表的关系。</p>
</li>
<li>
<p><strong>多对多关系（Many-to-Many Relationship）</strong>：学生表和课程表的关系。</p>
</li>
</ul>
<p>在多对多关系中，一个学生可以选修多门课程，一门课程也可以有多名学生选修。多对多关系通常通过一个中间表（关联表）来实现。</p>
<p>多对多关系也很好体现了关系型数据库存储的一些优势，考虑这样一种情形：每位同学拥有 <code>[sid, name, major]</code> 三个属性，每个课程拥有 <code>[cid, title, credit, time]</code> 四个属性，对于每个同学都有 <code>grade</code> 属性。</p>
<p>如果用一张 Excel 表格来存储有 10 个学生、每个学生均选择了 10 门相同的课程的情况，那么 Excel 表格的数据存储量约为
$$
(3 + 5) \times 10 \times 10 = 800
$$</p>
<p>而如果用数据库存储，我们只需要建立 <code>Students</code>, 'Courses', 'Association' 三张表。这里的  <code>Association</code> 就是中间表，用于存储同学与课程的选课关系，此时数据存储量约为 
$$
4 \times 10 + 5 \times 10 + 4 \times 10 \times 10 = 490
$$
相比使用 Excel 减少了很多。</p>
</div>
<h3 id="nosql">非关系型数据库（NoSQL）<a class="headerlink" href="#nosql" title="Permanent link">&para;</a></h3>
<p>与关系型数据库不同，<strong>非关系型数据库（NoSQL）</strong> 并不采用表格结构来存储数据，而是根据不同的应用场景，采用了多种灵活的数据模型。常见的 NoSQL 数据库类型包括：</p>
<ul>
<li><strong>文档型数据库</strong>：如 <a href="https://www.mongodb.com/">MongoDB</a>，以类似 JSON 的文档格式存储数据，适合存储结构灵活、层次丰富的数据。</li>
<li><strong>键值型数据库</strong>：如 <a href="https://redis.io/">Redis</a>，以键值对的形式存储数据，读写速度极快，常用于缓存和会话管理。</li>
<li><strong>列式数据库</strong>：如 <a href="https://cassandra.apache.org/">Apache Cassandra</a>，以列为单位存储数据，适合大规模分布式场景和分析型应用。</li>
<li><strong>图数据库</strong>：如 <a href="https://neo4j.com/">Neo4j</a>，以节点和边的形式存储数据，适合处理复杂的关系网络，如社交网络、推荐系统等。</li>
</ul>
<h4 id="_5">关系型数据库与非关系型数据库的主要区别<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>特性</th>
<th>关系型数据库（SQL）</th>
<th>非关系型数据库（NoSQL）</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据结构</td>
<td>表格（行和列）</td>
<td>文档、键值、列、图等多种结构</td>
</tr>
<tr>
<td>规范性</td>
<td>严格的模式（Schema）</td>
<td>灵活或无模式</td>
</tr>
<tr>
<td>事务支持</td>
<td>完整的 ACID 支持</td>
<td>部分支持，强调高可用和扩展性</td>
</tr>
<tr>
<td>扩展方式</td>
<td>垂直扩展为主</td>
<td>水平扩展为主</td>
</tr>
<tr>
<td>查询语言</td>
<td>SQL</td>
<td>各自特定的 API 或查询语言</td>
</tr>
<tr>
<td>适用场景</td>
<td>结构化数据、强一致性需求</td>
<td>海量数据、高并发、灵活结构</td>
</tr>
</tbody>
</table>
<p><strong>示例：</strong></p>
<ul>
<li>关系型数据库：适合银行、订单管理等对数据一致性要求高的场景。</li>
<li>非关系型数据库：适合社交网络、日志分析、物联网等对扩展性和灵活性要求高的场景。</li>
</ul>
<p>通过结合使用关系型和非关系型数据库，可以根据实际需求选择最合适的数据存储方案。</p>
<h2 id="sql_1">SQL 入门<a class="headerlink" href="#sql_1" title="Permanent link">&para;</a></h2>
<p>本次 <strong>数据库与 SQL</strong> 教程相比较于去年和前年的课程做了些许改变，不再使用 MySQL 作为示例工具进行展示和教学，而是使用了兼容更标准、功能更强大的 <a href="https://www.postgresql.org/">PostgreSQL</a> 作为主要的数据库示例。</p>
<p>PostgreSQL 以其高度的标准兼容性、丰富的特性和良好的扩展性，广泛应用于学术和工业界，同样是学习和实践 SQL 的优秀选择。</p>
<blockquote>
<p>有关 PostgreSQL 的安装，大家可以参考 <a href="https://www.postgresql.org/download/">https://www.postgresql.org/download/</a> 自行进行安装。</p>
</blockquote>
<p>（讲师授课和演示基于 macOS，部分指令还会给出 Ubuntu 版本，使用 Windows 的同学可以自行依照官方文档尝试或查询）</p>
<p>PostgreSQL 官网提供了非常全面的<a href="https://www.postgresql.org/docs/">技术文档</a>，同学们可以前往下载阅读或查询。</p>
<p>同时，PostgreSQL 官方还提供了一套面向 SQL 初学者的<a href="https://pgexercises.com">入门练习</a>，练习中设计了一个真实情境下的场馆管理系统，通过类似实际案例查询的形式，帮助初学者熟悉从简单到复杂的一系列 SQL 基本写法。</p>
<p>考虑到官方文档庞大的体量和阅读难度，本讲将会结合<a href="https://pgexercises.com">该入门练习</a>的部分例子，对照着文档循序渐进地进行部分 SQL 指令的讲解，<strong>在运用中学习是一个很好的学习方式</strong>。</p>
<ul>
<li>
<p>提供给大家练习用的 sql 脚本：</p>
<ul>
<li><a href="/basic/sql/Practice/summer.sql">一个学生、课程关系的数据库</a></li>
<li><a href="/basic/sql/Practice/clubdata.sql">来自于 PostgreSQL Exercises 上的会员、设施、预订关系的数据库</a></li>
</ul>
</li>
</ul>
<h3 id="_6">基本概念<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>回到正题，所以什么是 SQL ？</p>
<p><strong>SQL（Structured Query Language，结构化查询语言）</strong> 是一种专门用来与关系型数据库进行交互的标准化语言。它可以用来<strong>创建、查询、更新和删除</strong>数据库中的数据和结构，是数据库操作的核心工具。</p>
<p>SQL 主要包括以下几类指令：</p>
<ul>
<li><strong>数据查询语言（DQL）</strong>：如 <code>SELECT</code>，用于从数据库中检索数据。</li>
<li><strong>数据定义语言（DDL）</strong>：如 <code>CREATE</code>、<code>ALTER</code>、<code>DROP</code>，用于定义和修改数据库结构（如表、视图等）。</li>
<li><strong>数据操作语言（DML）</strong>：如 <code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>，用于对表中的数据进行增、删、改操作。</li>
<li><strong>数据控制语言（DCL）</strong>：如 <code>GRANT</code>、<code>REVOKE</code>，用于控制对数据库的访问权限。</li>
</ul>
<p>SQL 语句通常具有高度的可读性和结构化特点。例如，下面是一条简单的 SQL 查询语句：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>这条语句的含义是：从 <code>students</code> 表中查询所有 <code>age</code> 大于 18 的学生的 <code>name</code> 和 <code>age</code> 字段。</p>
<p>SQL 是一种声明式语言，用户只需描述“想要什么”，而不需要关心“如何实现”。数据库系统会自动优化和执行这些操作。</p>
<p>同时，SQL 也具有如下语言特性：</p>
<ul>
<li>脚本语言（类似 Python）：可以交互执行也可以事先写好后一次性执行；</li>
<li>强类型（区别于 MySQL 的弱类型）</li>
</ul>
<p align="center">
    <img src="/basic/sql/Practice/MySQL.jpg" alt="MySQL" width="45%"/>
    <img src="/basic/sql/Practice/PostgreSQL.png" alt="PostgreSQL" width="60%"/>
</p>

<p>在 PostgreSQL 中，有关大小写的区分：</p>
<ul>
<li>SQL 关键字：不区分大小写（如 SELECT, FROM, WHERE）。</li>
<li>标识符（表名、列名等）：<ul>
<li>如果你不加双引号，PostgreSQL 会自动将其转为小写；</li>
<li>如果你加双引号，则会严格区分大小写。</li>
</ul>
</li>
</ul>
<blockquote>
<p>在 PostgreSQL 中，<code>'</code> 标识的部分表示<strong>字符串常量</strong>，<code>"</code> 标识的部分表示<strong>精确标识符（区分大小写）</strong>。</p>
</blockquote>
<h3 id="_7">数据类型<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>PostgreSQL 支持丰富且灵活的数据类型，主要分为数值、字符、日期/时间、布尔、枚举、数组等类型。常用类型如下：</p>
<ul>
<li>
<p><strong>整数类型</strong></p>
<ul>
<li><code>INTEGER</code>（或 <code>INT</code>）：4 字节，范围 <span class="arithmatex"><span class="MathJax_Preview">[-2^{31}, 2^{31}-1]</span><script type="math/tex">[-2^{31}, 2^{31}-1]</script></span></li>
<li><code>BIGINT</code>：8 字节，范围 <span class="arithmatex"><span class="MathJax_Preview">[-2^{63}, 2^{63}-1]</span><script type="math/tex">[-2^{63}, 2^{63}-1]</script></span></li>
<li><code>SMALLINT</code>：2 字节，范围 <span class="arithmatex"><span class="MathJax_Preview">[-2^{15}, 2^{15}-1]</span><script type="math/tex">[-2^{15}, 2^{15}-1]</script></span></li>
<li>PostgreSQL 不支持 <code>UNSIGNED</code> 关键字，所有整数类型均为有符号类型。</li>
</ul>
</li>
<li>
<p><strong>浮点类型</strong></p>
<ul>
<li><code>REAL</code>：4 字节，单精度浮点数</li>
<li><code>DOUBLE PRECISION</code>：8 字节，双精度浮点数</li>
<li><code>NUMERIC(p, s)</code> / <code>DECIMAL(p, s)</code>：可变精度定点数，适合高精度计算（如财务数据）</li>
</ul>
</li>
<li>
<p><strong>字符类型</strong></p>
<ul>
<li><code>CHAR(n)</code>：定长字符串，长度为 n，空白自动填充</li>
<li><code>VARCHAR(n)</code>：变长字符串，最大长度 n</li>
<li><code>TEXT</code>：变长字符串，无长度限制，适合存储大文本</li>
</ul>
</li>
<li>
<p><strong>日期/时间类型</strong></p>
<ul>
<li><code>DATE</code>：仅日期，格式 <code>YYYY-MM-DD</code></li>
<li><code>TIME</code>：仅时间，格式 <code>hh:mm:ss</code></li>
<li><code>TIMESTAMP</code>：日期和时间，格式 <code>YYYY-MM-DD hh:mm:ss[.fraction]</code></li>
<li><code>TIMESTAMPTZ</code>：带时区的时间戳</li>
</ul>
</li>
<li>
<p><strong>布尔类型</strong></p>
<ul>
<li><code>BOOLEAN</code>：取值为 <code>TRUE</code>、<code>FALSE</code></li>
</ul>
</li>
<li>
<p><strong>其他常用类型</strong></p>
<ul>
<li><code>SERIAL</code> / <code>BIGSERIAL</code>：自增整数，常用于主键（本质上是整数+序列）</li>
<li><code>UUID</code>：通用唯一标识符</li>
<li><code>ARRAY</code>：数组类型，如 <code>INTEGER[]</code></li>
<li><code>JSON</code> / <code>JSONB</code>：存储 JSON 格式数据，<code>JSONB</code> 支持高效索引和查询</li>
</ul>
</li>
<li>
<p>特别的，<code>NULL</code> 表示空值（与 <code>0</code> 和 <code>''</code> 作区分）。在没有被分配值且没有默认值得字段在插入时会被分配 NULL 这个空值来表示记录中的某个字段没有数据。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">age</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">        </span><span class="n">balance</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
<span class="w">        </span><span class="n">created_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">        </span><span class="n">is_active</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">TRUE</span><span class="p">,</span>
<span class="w">        </span><span class="n">tags</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">[],</span>
<span class="w">        </span><span class="n">profile</span><span class="w"> </span><span class="n">JSONB</span>
<span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p><strong>特别说明：</strong>
- PostgreSQL 推荐尽量避免允许字段为 <code>NULL</code>，以简化查询和提升性能。
- 与 MySQL 不同，PostgreSQL 没有 <code>UNSIGNED</code> 类型，若需存储非负数请自行约束。
- <code>TEXT</code> 类型在 PostgreSQL 中没有长度限制，适合大文本存储。
- <code>TIMESTAMPTZ</code> 推荐用于需要时区信息的时间存储。</p>
<p>更多详细数据类型可参考官方文档：<a href="https://www.postgresql.org/docs/current/datatype.html">PostgreSQL Data Types</a></p>
<h3 id="_8">主键、外键和索引<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<h4 id="primary-key">主键（Primary Key）<a class="headerlink" href="#primary-key" title="Permanent link">&para;</a></h4>
<p>主键用于唯一标识表中的每一行，要求<strong>唯一且非空</strong>。在 PostgreSQL 中，常用 <code>SERIAL</code> 或 <code>BIGSERIAL</code> 类型配合 <code>PRIMARY KEY</code> 自动生成自增主键。例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>也可以使用多个字段作为<strong>联合主键</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">association</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">student_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">course_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="n">course_id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h4 id="foreign-key">外键（Foreign Key）<a class="headerlink" href="#foreign-key" title="Permanent link">&para;</a></h4>
<p>外键用于建立表与表之间的关联，保证引用的数据存在，维护数据一致性。例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">association</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">student_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">students</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">course_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">courses</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>可以通过 <code>ON DELETE CASCADE</code> 等选项设置级联操作：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">association</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">student_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">students</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="n">course_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">courses</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>级联操作</strong>是指在数据库中，当对某个表（如父表）执行删除或更新操作时，相关联的另一个表（如子表）会自动进行相应的操作。例如，使用 ON DELETE CASCADE 时，如果删除了父表中的一条记录，所有引用该记录的子表数据也会被自动删除。这有助于保持数据的一致性，避免出现“孤儿”数据。</p>
<p>常见的级联操作有：</p>
<ul>
<li><code>ON DELETE CASCADE</code>：删除父表记录时，自动删除所有相关的子表记录。</li>
<li><code>ON UPDATE CASCADE</code>：更新父表主键时，自动更新所有相关的子表外键。</li>
<li><code>ON DELETE SET NULL</code>：删除父表记录时，将子表中相关外键字段设置为 NULL。</li>
<li><code>ON DELETE RESTRICT</code>：如果子表中存在相关记录，则不允许删除父表记录。</li>
</ul>
<p>这样可以简化数据维护，减少手动同步数据的工作量。</p>
</div>
<h4 id="index">索引（Index）<a class="headerlink" href="#index" title="Permanent link">&para;</a></h4>
<p>索引用于加速查询，主键和唯一约束会自动创建索引。对于经常查询的字段，可以手动添加索引：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_name</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">students</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>索引提升查询效率，但会略微影响插入和更新性能。</p>
<p>更多约束如 <code>UNIQUE</code>、<code>NOT NULL</code>、<code>CHECK</code>、<code>DEFAULT</code> 也可用于保证数据完整性，具体语法与 MySQL 类似。</p>
<h3 id="_9">数据库和数据表操作<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<h4 id="_10">前期准备<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p><strong>1. 启动 PostgreSQL 服务</strong></p>
<ul>
<li><strong>macOS</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>brew<span class="w"> </span>services<span class="w"> </span>start<span class="w"> </span>postgresql@xx
</code></pre></div></td></tr></table></div></li>
<li><strong>Ubuntu</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>postgresql
</code></pre></div></td></tr></table></div></li>
</ul>
<p><strong>2. 登录 PostgreSQL 服务</strong></p>
<ul>
<li>
<p><strong>选择数据库进行连接</strong>：</p>
<ul>
<li><strong>macOS</strong>：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>psql<span class="w"> </span>-U<span class="w"> </span>&lt;用户名&gt;<span class="w"> </span>-f<span class="w"> </span>&lt;sql脚本文件&gt;<span class="w"> </span>-d<span class="w"> </span>&lt;数据库名&gt;
</code></pre></div></td></tr></table></div><blockquote>
<p>没有指定 <code>-U</code> 参数时，会以默认 <code>whoami</code> 的用户进行登录。</p>
</blockquote>
</li>
</ul>
<p>默认情况下，PostgreSQL 安装完后会自带一个 postgres 数据库，用于帮助用户进入命令行工具。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>psql<span class="w"> </span>postgres
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>Ubuntu</strong>：
在 Ubuntu 等 Linux 系统中，需要先切换到 postgres 用户，随后再进入 PostgreSQL 服务：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>sudo<span class="w"> </span>-i<span class="w"> </span>-u<span class="w"> </span>postgres
psql
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
</ul>
<h4 id="_11">数据库相关<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p><strong>1. 创建数据库（CREATE）</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>createdb<span class="w"> </span>-U<span class="w"> </span>&lt;用户名&gt;<span class="w"> </span>&lt;数据库名&gt;
</code></pre></div></td></tr></table></div>
<p>你也可以进入 PostgreSQL，然后执行：
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">mydb</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
<p><strong>2. 切换数据库</strong></p>
<p>在 <code>psql</code> 命令行下，使用如下命令切换数据库：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">\</span><span class="k">c</span><span class="w"> </span><span class="n">summer25</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>\c</code> 是 <code>connect</code> 的含义。</li>
</ul>
<p><strong>3. 查看数据库列表</strong></p>
<p>列出所有数据库：
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">\</span><span class="n">l</span>
</code></pre></div></td></tr></table></div></p>
<ul>
<li><code>\l</code> 是 <code>list</code> 的含义。</li>
</ul>
<p><strong>4. 删除数据库（DROP）</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">summer25</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p><strong>5. 重命名数据库（ALTER）</strong></p>
<p>只能在数据库未被连接时操作（不能重命名当前连接的数据库），例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">oldname</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">newname</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h4 id="_12">表相关<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p><strong>1.创建数据表（CREATE）</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Students</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">sid</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">major</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Courses</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">cid</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">credit</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">time</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Association</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">student_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">course_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">grade</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_student_id</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">student_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">Students</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_course_id</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">course_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">Courses</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p><strong>2.查看数据表</strong></p>
<ul>
<li>
<p><strong>列出当前数据库的所有表</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">\</span><span class="n">dt</span>
</code></pre></div></td></tr></table></div></p>
<ul>
<li><code>\dt</code> 是 <code>describe tables</code> 或 <code>display tables</code></li>
</ul>
</li>
<li>
<p><strong>查看表结构</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">\</span><span class="n">d</span><span class="w"> </span><span class="n">association</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>\d</code> 是 <code>describe</code> 的含义</li>
</ul>
</li>
</ul>
<p><strong>3.修改表结构（ALTER）</strong></p>
<ul>
<li><strong>添加字段</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</code></pre></div></td></tr></table></div></li>
<li><strong>删除字段</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">gender</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></li>
<li><strong>修改字段类型</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">sid</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</code></pre></div></td></tr></table></div></li>
<li><strong>添加索引</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_sid</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">students</span><span class="p">(</span><span class="n">sid</span><span class="p">);</span>
</code></pre></div></td></tr></table></div></li>
<li><strong>删除外键</strong>（需先查外键名）：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">association</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">association_student_id_fkey</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p><strong>4.重命名表和字段</strong></p>
<ul>
<li><strong>重命名表</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">learners</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></li>
<li><strong>重命名字段</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">learners</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">full_name</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p><strong>5.删除表（DROP）</strong></p>
<ul>
<li><strong>删除表</strong>：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">learners</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<blockquote>
<p><strong>更多 <code>psql</code> 命令可通过 <code>\h</code>（查看 SQL 语法帮助）和 <code>\?</code>（查看 psql 命令帮助）获取。</strong></p>
</blockquote>
<h3 id="crud">CRUD<a class="headerlink" href="#crud" title="Permanent link">&para;</a></h3>
<blockquote>
<p>In computer programming, <strong>create, read, update, and delete</strong> (<strong>CRUD</strong>) are the four basic operations of <a href="https://en.wikipedia.org/wiki/Persistent_storage">persistent storage</a>.</p>
</blockquote>
<p>每个字母代表一个操作：</p>
<table>
<thead>
<tr>
<th style="text-align: center;">CRUD</th>
<th style="text-align: center;">SQL</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">Create</td>
<td style="text-align: center;">INSERT</td>
</tr>
<tr>
<td style="text-align: center;">Read</td>
<td style="text-align: center;">SELECT</td>
</tr>
<tr>
<td style="text-align: center;">Update</td>
<td style="text-align: center;">UPDATE</td>
</tr>
<tr>
<td style="text-align: center;">Delete</td>
<td style="text-align: center;">DELETE</td>
</tr>
</tbody>
</table>
<p>本部分讲义基于 <a href="https://pgexercises.com">PostgreSQL Exercises</a> 上的练习题目展开，读者可以自行前往 <a href="https://pgexercises.com/gettingstarted.html">https://pgexercises.com/gettingstarted.html</a> 下载该部分练习使用的<strong>数据库文件</strong>和<strong>查询对应的表结构</strong>。</p>
<p align="center">
    <img src="/basic/sql/Practice/schema-horizontal.svg" alt="schema" width="800"/>
</p>

<h4 id="insert">INSERT<a class="headerlink" href="#insert" title="Permanent link">&para;</a></h4>
<p>Modifying Data 相关的操作都比较简单。读者可参考 <a href="https://pgexercises.com/questions/updates/">https://pgexercises.com/questions/updates/</a> 自行学习。此处仅给出代码示例。</p>
<ul>
<li>
<p>插入单条记录：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span>
<span class="p">(</span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">membercost</span><span class="p">,</span><span class="w"> </span><span class="n">guestcost</span><span class="p">,</span><span class="w"> </span><span class="n">initialoutlay</span><span class="p">,</span><span class="w"> </span><span class="n">monthlymaintenance</span><span class="p">)</span>
<span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Spa&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">100000</span><span class="p">,</span><span class="w"> </span><span class="mi">800</span><span class="p">);</span><span class="w">  </span>
</code></pre></div></td></tr></table></div></p>
<p>如果按照一开始定义表时的字段顺序，下述插入指令也是可以的：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Spa&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">100000</span><span class="p">,</span><span class="w"> </span><span class="mi">800</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>插入多条记录：
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span>
<span class="w">    </span><span class="p">(</span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">membercost</span><span class="p">,</span><span class="w"> </span><span class="n">guestcost</span><span class="p">,</span><span class="w"> </span><span class="n">initialoutlay</span><span class="p">,</span><span class="w"> </span><span class="n">monthlymaintenance</span><span class="p">)</span>
<span class="w">    </span><span class="k">values</span>
<span class="w">        </span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Spa&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">100000</span><span class="p">,</span><span class="w"> </span><span class="mi">800</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Squash Court 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">);</span><span class="w">  </span>
</code></pre></div></td></tr></table></div></p>
<p>另一种写法：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span>
<span class="w">    </span><span class="p">(</span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">membercost</span><span class="p">,</span><span class="w"> </span><span class="n">guestcost</span><span class="p">,</span><span class="w"> </span><span class="n">initialoutlay</span><span class="p">,</span><span class="w"> </span><span class="n">monthlymaintenance</span><span class="p">)</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Spa&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">100000</span><span class="p">,</span><span class="w"> </span><span class="mi">800</span>
<span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Squash Court 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>带有计算的插入记录：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span>
<span class="p">(</span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">membercost</span><span class="p">,</span><span class="w"> </span><span class="n">guestcost</span><span class="p">,</span><span class="w"> </span><span class="n">initialoutlay</span><span class="p">,</span><span class="w"> </span><span class="n">monthlymaintenance</span><span class="p">)</span>
<span class="k">select</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">facid</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Spa&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">100000</span><span class="p">,</span><span class="w"> </span><span class="mi">800</span><span class="p">;</span><span class="w">   </span>
</code></pre></div></td></tr></table></div></p>
</li>
</ul>
<h4 id="update">UPDATE<a class="headerlink" href="#update" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>更新单个字段：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span>
<span class="k">set</span><span class="w"> </span><span class="n">initialoutlay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span>
<span class="k">where</span><span class="w"> </span><span class="n">facid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">          </span>
</code></pre></div></td></tr></table></div></p>
<p>不通过 <code>where</code> 指定的话，会更新所有记录。</p>
</li>
<li>
<p>更新多个字段：
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span>
<span class="w">  </span><span class="k">set</span>
<span class="w">      </span><span class="n">membercost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">      </span><span class="n">guestcost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span>
<span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">facid</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w">   </span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>依据记录更新字段：
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="n">facs</span>
<span class="w">    </span><span class="k">set</span>
<span class="w">        </span><span class="n">membercost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">membercost</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">facid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">        </span><span class="n">guestcost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">guestcost</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">facid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">facs</span><span class="p">.</span><span class="n">facid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span>
</code></pre></div></td></tr></table></div></p>
<p>Postgres 提供了一个名为 UPDATE...FROM SQL 的非标准扩展，它允许您提供一个 FROM 子句来生成用于子 SET 句的值。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="n">facs</span>
<span class="k">set</span>
<span class="w">    </span><span class="n">membercost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">facs2</span><span class="p">.</span><span class="n">membercost</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">guestcost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">facs2</span><span class="p">.</span><span class="n">guestcost</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span>
<span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">facid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">facs2</span>
<span class="k">where</span><span class="w"> </span><span class="n">facs</span><span class="p">.</span><span class="n">facid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
</li>
</ul>
<h4 id="delete">DELETE<a class="headerlink" href="#delete" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>删除表中所有字段：
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span><span class="p">;</span><span class="w">    </span>
</code></pre></div></td></tr></table></div></p>
<p>你还可以使用 <code>TRUNCATE</code>，这个指令更快更底层。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">truncate</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>删除表中指定记录：
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">memid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">37</span><span class="p">;</span><span class="w">   </span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>运用子查询：
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">memid</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">memid</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span><span class="p">);</span><span class="w">    </span>
</code></pre></div></td></tr></table></div></p>
</li>
</ul>
<h4 id="select">SELECT<a class="headerlink" href="#select" title="Permanent link">&para;</a></h4>
<p><code>SELECT</code> 是获取数据最基本的操作。</p>
<h5 id="basic">BASIC<a class="headerlink" href="#basic" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>获取 <strong>所有</strong> 字段（<a href="https://pgexercises.com/questions/basic/selectall.html">Basic.Q1</a>）：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>获取 <strong>部分</strong> 字段（<a href="https://pgexercises.com/questions/basic/selectspecific.html">Basic.Q2</a>）：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">membercost</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
</li>
</ul>
<h5 id="where">WHERE<a class="headerlink" href="#where" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>获取 <strong>条件筛选</strong> 后的字段（<a href="https://pgexercises.com/questions/basic/where.html">Basic.Q3</a>, <a href="https://pgexercises.com/questions/basic/where2.html">Basic.Q4</a>）：</p>
<p>在 SQL 中，使用 <code>WHERE</code> 配合 <code>SELECT</code>，可以实现基于条件表达式的筛选：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">membercost</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="k">select</span><span class="w"> </span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">membercost</span><span class="p">,</span><span class="w"> </span><span class="n">monthlymaintenance</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">monthlymaintenance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3000</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p>SQL 中的“不等于”可以使用 <code>&lt;&gt;</code> 或 <code>!=</code>，等于只需要使用 <code>=</code> 。</p>
</blockquote>
</li>
</ul>
<h5 id="and-or-not">AND, OR, NOT<a class="headerlink" href="#and-or-not" title="Permanent link">&para;</a></h5>
<p>除此之外，SQL 还支持多个条件表达式的逻辑组合。</p>
<ul>
<li>基本的逻辑关系符有 <code>AND</code>, <code>OR</code>, <code>NOT</code>。
      <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">memid</span><span class="p">,</span><span class="w"> </span><span class="n">firstname</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">memid</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">firstname</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">surname</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<h5 id="null">NULL<a class="headerlink" href="#null" title="Permanent link">&para;</a></h5>
<p>上述例子也展现了一个特殊的类型: <code>NULL</code> 类型。</p>
<p>如前所述，没有被分配值且没有默认值得字段在插入时会被分配 <code>NULL</code> 这个空值来表示记录中的某个字段没有数据。</p>
<p>在 PostgreSQL 中，不能直接通过 <code>firstname = NULL</code> 这样的语句来判断一个值是不是 <code>NULL</code>，而需要通过 <code>is null</code> 和 <code>is not null</code> 表达式。</p>
<h5 id="in">IN<a class="headerlink" href="#in" title="Permanent link">&para;</a></h5>
<ul>
<li>基于 <strong>指定范围</strong> 的条件筛选（<a href="https://pgexercises.com/questions/basic/where4.html">Basic.Q6</a>）：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span>
<span class="w">        </span><span class="n">facid</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span>
<span class="w">    </span><span class="k">where</span>
<span class="w">        </span><span class="n">facid</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="k">select</span><span class="w"> </span><span class="n">facid</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span>
<span class="w">            </span><span class="p">);</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<h5 id="like">LIKE<a class="headerlink" href="#like" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>基于 <strong>匹配</strong> 的条件筛选（<a href="https://pgexercises.com/questions/basic/where3.html">Basic.Q5</a>, <a href="https://pgexercises.com/questions/string/reg.html">String.Q4</a>）：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%Tennis%&#39;</span><span class="p">;</span><span class="w"> </span>
</code></pre></div></td></tr></table></div></p>
<blockquote>
<p>SQL's <code>LIKE</code> operator provides simple pattern matching on strings. It's pretty much universally implemented, and is nice and simple to use - it just takes a string with the % character matching any string, and _ matching any single character. </p>
</blockquote>
<p>顺带一提，也可以使用 <code>~</code> 来匹配<strong>正则表达式</strong>，不过使用 <code>LIKE</code> 处理简单匹配会更加的便携一些。</p>
</li>
</ul>
<h5 id="case">CASE<a class="headerlink" href="#case" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>依据条件 <strong>分类</strong> 进行筛选（<a href="https://pgexercises.com/questions/basic/classify.html">Basic.Q7</a>）：
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">monthlymaintenance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="s1">&#39;expensive&#39;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="s1">&#39;cheap&#39;</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cost</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="p">;</span><span class="w">          </span>
</code></pre></div></td></tr></table></div></p>
<p><code>CASE</code> 语句实际上支持多个 <code>WHEN</code>，且并不一定需要 <code>ELSE</code> 来（也就是并不需要覆盖所有情况），对于未覆盖到的情况，则会返回 <code>NULL</code> 。</p>
</li>
</ul>
<h5 id="operation-on-date">OPERATION ON DATE<a class="headerlink" href="#operation-on-date" title="Permanent link">&para;</a></h5>
<p>在 SQL 中，日期具有固定的类型和格式，比如对于 <code>timestamp</code> 时间戳，固定为 <code>YYYY-MM-DD HH:MM:SS.nnnnnn</code> 格式。</p>
<ul>
<li>
<p>对于时间戳，用户像比较 unix 时间戳一样比较它们（<a href="https://pgexercises.com/questions/basic/date.html">Basic.Q8</a>）：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">memid</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span><span class="p">,</span><span class="w"> </span><span class="n">firstname</span><span class="p">,</span><span class="w"> </span><span class="n">joindate</span><span class="w"> </span>
<span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span>
<span class="k">where</span><span class="w"> </span><span class="n">joindate</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2012-09-01&#39;</span><span class="p">;</span><span class="w">  </span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>也可以通过将时间戳 <strong>相减</strong>，得到 <strong>时间间隔</strong> （<a href="https://pgexercises.com/questions/date/interval.html">Date.Q2</a>）。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="s1">&#39;2012-08-31 01:00:00&#39;</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="s1">&#39;2012-07-30 01:00:00&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">interval</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
<p>更多有关 <code>Date</code> 相应类型的操作和用法，读者可以继续阅读和尝试如下<a href="https://pgexercises.com/questions/date/">Date 练习</a>。配合 <code>extract</code>, <code>date_trunc</code> 等函数使用，可以实现更多效果。</p>
<h5 id="distinct">DISTINCT<a class="headerlink" href="#distinct" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p><strong>去重</strong>（<a href="https://pgexercises.com/questions/basic/unique.html">Basic.Q9</a>）：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">surname</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
<h5 id="order-by-limit">ORDER BY &amp; Limit<a class="headerlink" href="#order-by-limit" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p><strong>排序和限制输出个数</strong>（<a href="https://pgexercises.com/questions/basic/unique.html">Basic.Q9</a>）：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">surname</span><span class="w"> </span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">surname</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">   </span>
</code></pre></div></td></tr></table></div>
<p>运用 <code>LIMIT</code> 和 <code>ORDER BY</code>，实际上可以起到了筛选最大值/最小值的效果（<a href="https://pgexercises.com/questions/basic/agg2.html">Basic.Q12</a>）：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">firstname</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span><span class="p">,</span><span class="w"> </span><span class="n">joindate</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">joindate</span><span class="w"> </span><span class="k">desc</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
<h5 id="union">UNION<a class="headerlink" href="#union" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p><strong>链接</strong> 不同表的查询结果（<a href="https://pgexercises.com/questions/basic/union.html">Basic.Q10</a>）</p>
<p>通过 <code>UNION</code> 可以将多个表的查询结果，合并在一张表中（记录层面上的链接，而非字段）
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">surname</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
</li>
</ul>
<h4 id="joins-and-subqueries">Joins and Subqueries<a class="headerlink" href="#joins-and-subqueries" title="Permanent link">&para;</a></h4>
<p align="center">
    <img src="/basic/sql/Practice/join.png" alt="Join" width="600"/>
</p>

<p>很多时候出于设计的规范性与便携性，我们会在各个对象（会员、设施等）各自表中维护具体的字段（名称、费用等），而在 <code>Association</code> 表（比如这里等 <code>cd.bookings</code> 表）中，仅维护其他对象表的 <code>id</code> 和必要的信息。比如在这里的预定表中，我们通过维护 <code>memid</code> 和 <code>facid</code> 两个外键，来关联到会员表和设施表。</p>
<p>但是仅仅通过 <code>id</code>，并不能让我们在查询预订表中获得更多的信息，查询起来也显得不够便捷。比如我希望查询名为 David Farrell 的用户的所有预订，我就需要经历</p>
<ol>
<li>通过 <code>cd.members</code> 表查询用户 <code>memid</code></li>
<li>利用 <code>memid</code> 在 <code>cd.bookings</code> 中查询对应预订信息</li>
</ol>
<p>当关联的表格增多，关系变复杂时，这种操作是不太能容忍的。有没有什么方式，可以更加便捷地进行查询呢？</p>
<p>观察我们在查询步骤中的核心思想，其实是需要找出两张表中有关联的字段，然后像原先我们存储在 Excel 中那样，扩展成一张大的表，随后再进行查询时，就能获得足够多我们想要的信息了。</p>
<p>PostgreSQL 为我们提供了 <code>JOIN</code> 这样的工具，来帮助我们完成这一操作。</p>
<p><code>JOIN</code> 的<strong>基本思想</strong>是，将两张表的记录逐一取出，依据 <code>ON</code> 提供的条件式进行比对，当满足条件时，放入一张新的表。<strong>也就是说，<code>JOIN</code> 的结果是一张新的表。</strong></p>
<p>你可以使用 <code>AS</code> 给表起别名，或者直接将别名跟在表后。</p>
<p><strong>实际上，一次 <code>SELECT</code>，就是一次生成表的过程。</strong>在 <code>Subqueries</code> 中我们将看到，我们可以通过 <code>()</code> 的形式，来捕获一次表生成的结果，用来给另一条语句使用，也就构成了多重查询。</p>
<p>有关 <code>JOIN</code> 和 <code>Subqueries</code> 的使用方式和原理，在 <a href="https://pgexercises.com/questions/joins/">Joins and Subqueries</a> 中有极好的体现，推荐读者自行前往尝试下链接中的几个习题。此处摘出其中的两道作为样例与对比：</p>
<ul>
<li><a href="https://pgexercises.com/questions/joins/threejoin2.html">Produce a list of costly bookings</a></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">firstname</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">surname</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">member</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">facs</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">facility</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span>
<span class="w">      </span><span class="k">when</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">memid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="n">bks</span><span class="p">.</span><span class="n">slots</span><span class="o">*</span><span class="n">facs</span><span class="p">.</span><span class="n">guestcost</span>
<span class="w">      </span><span class="k">else</span>
<span class="w">          </span><span class="n">bks</span><span class="p">.</span><span class="n">slots</span><span class="o">*</span><span class="n">facs</span><span class="p">.</span><span class="n">membercost</span>
<span class="w">  </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cost</span>
<span class="w">        </span><span class="k">from</span>
<span class="w">                </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="n">mems</span><span class="w">                </span>
<span class="w">                </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span><span class="w"> </span><span class="n">bks</span>
<span class="w">                        </span><span class="k">on</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">memid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bks</span><span class="p">.</span><span class="n">memid</span>
<span class="w">                </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="n">facs</span>
<span class="w">                        </span><span class="k">on</span><span class="w"> </span><span class="n">bks</span><span class="p">.</span><span class="n">facid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">facs</span><span class="p">.</span><span class="n">facid</span>
<span class="w">        </span><span class="k">where</span>
<span class="w">      </span><span class="n">bks</span><span class="p">.</span><span class="n">starttime</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2012-09-14&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span>
<span class="w">      </span><span class="n">bks</span><span class="p">.</span><span class="n">starttime</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;2012-09-15&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span>
<span class="w">          </span><span class="p">(</span><span class="n">mems</span><span class="p">.</span><span class="n">memid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">bks</span><span class="p">.</span><span class="n">slots</span><span class="o">*</span><span class="n">facs</span><span class="p">.</span><span class="n">guestcost</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">or</span>
<span class="w">          </span><span class="p">(</span><span class="n">mems</span><span class="p">.</span><span class="n">memid</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">bks</span><span class="p">.</span><span class="n">slots</span><span class="o">*</span><span class="n">facs</span><span class="p">.</span><span class="n">membercost</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
<span class="w">      </span><span class="p">)</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">desc</span><span class="p">;</span><span class="w">   </span>
</code></pre></div></td></tr></table></div>
<ul>
<li><a href="https://pgexercises.com/questions/joins/tjsub.html">Produce a list of costly bookings, using a subquery</a></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">member</span><span class="p">,</span><span class="w"> </span><span class="n">facility</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">select</span><span class="w"> </span>
<span class="w">      </span><span class="n">mems</span><span class="p">.</span><span class="n">firstname</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">surname</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">member</span><span class="p">,</span>
<span class="w">      </span><span class="n">facs</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">facility</span><span class="p">,</span>
<span class="w">      </span><span class="k">case</span>
<span class="w">          </span><span class="k">when</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">memid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="n">bks</span><span class="p">.</span><span class="n">slots</span><span class="o">*</span><span class="n">facs</span><span class="p">.</span><span class="n">guestcost</span>
<span class="w">          </span><span class="k">else</span>
<span class="w">              </span><span class="n">bks</span><span class="p">.</span><span class="n">slots</span><span class="o">*</span><span class="n">facs</span><span class="p">.</span><span class="n">membercost</span>
<span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cost</span>
<span class="w">      </span><span class="k">from</span>
<span class="w">          </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="n">mems</span>
<span class="w">          </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span><span class="w"> </span><span class="n">bks</span>
<span class="w">              </span><span class="k">on</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">memid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bks</span><span class="p">.</span><span class="n">memid</span>
<span class="w">          </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="n">facs</span>
<span class="w">              </span><span class="k">on</span><span class="w"> </span><span class="n">bks</span><span class="p">.</span><span class="n">facid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">facs</span><span class="p">.</span><span class="n">facid</span>
<span class="w">      </span><span class="k">where</span>
<span class="w">          </span><span class="n">bks</span><span class="p">.</span><span class="n">starttime</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2012-09-14&#39;</span><span class="w"> </span><span class="k">and</span>
<span class="w">          </span><span class="n">bks</span><span class="p">.</span><span class="n">starttime</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;2012-09-15&#39;</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">bookings</span>
<span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">desc</span><span class="p">;</span><span class="w">          </span>
</code></pre></div></td></tr></table></div>
<ul>
<li><a href="https://pgexercises.com/questions/joins/self2.html">Produce a list of all members, along with their recommender</a></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">firstname</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">memfname</span><span class="p">,</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">surname</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">memsname</span><span class="p">,</span><span class="w"> </span><span class="n">recs</span><span class="p">.</span><span class="n">firstname</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">recfname</span><span class="p">,</span><span class="w"> </span><span class="n">recs</span><span class="p">.</span><span class="n">surname</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">recsname</span>
<span class="w">  </span><span class="k">from</span><span class="w"> </span>
<span class="w">      </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="n">mems</span>
<span class="w">      </span><span class="k">left</span><span class="w"> </span><span class="k">outer</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="n">recs</span>
<span class="w">          </span><span class="k">on</span><span class="w"> </span><span class="n">recs</span><span class="p">.</span><span class="n">memid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">recommendedby</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">memsname</span><span class="p">,</span><span class="w"> </span><span class="n">memfname</span><span class="p">;</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<ul>
<li><a href="https://pgexercises.com/questions/joins/sub.html">Produce a list of all members, along with their recommender, using no joins.</a></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">firstname</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">||</span><span class="w">  </span><span class="n">mems</span><span class="p">.</span><span class="n">surname</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">member</span><span class="p">,</span>
<span class="w">  </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">recs</span><span class="p">.</span><span class="n">firstname</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">recs</span><span class="p">.</span><span class="n">surname</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">recommender</span><span class="w"> </span>
<span class="w">      </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="n">recs</span><span class="w"> </span>
<span class="w">      </span><span class="k">where</span><span class="w"> </span><span class="n">recs</span><span class="p">.</span><span class="n">memid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">recommendedby</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="k">from</span><span class="w"> </span>
<span class="w">      </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="n">mems</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">member</span><span class="p">;</span><span class="w">          </span>
</code></pre></div></td></tr></table></div>
<p>另外一个子查询极好的例子，我们将在 <strong>Aggregates</strong> 部分结束后看到。</p>
<ul>
<li>顺带一提，上述例子展现了 <strong>字符串拼接</strong> 的基本方式。</li>
</ul>
<h4 id="aggregates">Aggregates<a class="headerlink" href="#aggregates" title="Permanent link">&para;</a></h4>
<h5 id="basic_1">BASIC<a class="headerlink" href="#basic_1" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p><strong>聚合</strong> 函数（<a href="https://pgexercises.com/questions/basic/agg.html">Basic.Q11</a>, <a href="https://pgexercises.com/questions/basic/agg2.html">Basic.Q12</a>）</p>
<p>SQL 提供了<strong>聚合</strong>函数这一强大的工具，用于将表中某一字段所有记录的数据通过某种特定的计算得到一个新的值。</p>
<ul>
<li>例如在（<a href="https://pgexercises.com/questions/aggregates/count.html">Aggregates.Q1</a>） 中，我们通过 <code>COUNT</code> 计算表中所有条目的个数：</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>COUNT</code> 等函数也可以配合 <code>WHERE</code> 使用（<a href="https://pgexercises.com/questions/aggregates/count2.html">Aggregates.Q2</a>）：</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">facilities</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">guestcost</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>在（<a href="https://pgexercises.com/questions/basic/agg.html">Basic.Q11</a>, <a href="https://pgexercises.com/questions/basic/agg2.html">Basic.Q12</a>）中，我们通过 <code>MAX</code> 来得到表中的最大值。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">firstname</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span><span class="p">,</span><span class="w"> </span><span class="n">joindate</span>
<span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span>
<span class="k">where</span><span class="w"> </span><span class="n">joindate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">    </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">joindate</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="p">);</span><span class="w">          </span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>你可能会在（<a href="https://pgexercises.com/questions/basic/agg2.html">Basic.Q12</a>）中尝试如下代码：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">firstname</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">joindate</span><span class="p">)</span>
<span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>这是一个很自然的想法，但是不幸的是，这在 SQL 中并行不通，这是因为 <code>MAX</code> 并不是像 <code>WHERE</code> 那样限制选出的行，而是仅接受一大堆值，然后返回一个最大的值。上述代码会导致 PostgreSQL 不知道怎么将返回了一堆行的firstname, surname 的列表和只返回一行的 <code>MAX</code> 匹配连接起来。所以从语义上，你必须说“为我找到入会日期与最大入会日期相同的行”，也就是 <strong>两步</strong> 操作。</p>
<p>当然，你也可以通过排序然后取顶部行解决这个问题，二者是等价的。</p>
</div>
<p>最常用的聚合函数，有 <code>COUNT</code>, <code>MAX</code>, <code>MIN</code>, <code>AVG</code>, <code>SUM</code>。</p>
<p>更多 PostgreSQL 提供的聚合函数，可以去如下网址查找 <a href="https://www.postgresql.org/docs/current/functions-aggregate.html">https://www.postgresql.org/docs/current/functions-aggregate.html</a>。</p>
</li>
</ul>
<h5 id="group-by">GROUP BY<a class="headerlink" href="#group-by" title="Permanent link">&para;</a></h5>
<p>我们在上一节中提到，如果你使用如下代码，PostgreSQL 会因为不知如何连接多值和单值而报错：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">firstname</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">joindate</span><span class="p">)</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>但是不是意味着 <code>select firstname, surname, max(joindate)</code> 这样子的语句就不能存在了呢？实际上并不是，我们其实经常会遇到如下需要将表计算值和行记录连接在一起的情形：</p>
<ul>
<li><strong>分组统计</strong>（<a href="https://pgexercises.com/questions/aggregates/fachours.html">Aggregates.Q4</a>）：</li>
</ul>
<p>我有一张设施使用记录的表，现在我想统计每个设施的总使用时长:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ss">&quot;Total Slots&quot;</span>
<span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span>
<span class="w">  </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span><span class="p">;</span><span class="w">          </span>
</code></pre></div></td></tr></table></div>
<p><code>GROUP BY</code> 会将数据批处理成组，并为每个组单独运行聚合函数。指定 GROUP BY 时，数据库会为提供的列中的每个不同值生成聚合值。这样子，就能实现我们分组统计的目的。</p>
<p><strong>需要注意的是</strong>，在 PostgreSQL 中使用 <code>GROUP BY</code> 时，出现在 <code>SELECT</code> 中的非 <code>Aggregates</code> 的字段，都需要放入 <code>GROUP BY</code> 中，尽管有时候看上去对一些唯一的字段（如 id）做分组并没有意义。（MySQL 中似乎可以选择是否开启这个检查）</p>
<h5 id="having">HAVING<a class="headerlink" href="#having" title="Permanent link">&para;</a></h5>
<p>考虑上面那道题的进阶版，我希望列出设施使用总 slots 超过 1000 的设施（<a href="https://pgexercises.com/questions/aggregates/fachours1a.html">Aggregates.Q8</a>）：</p>
<p>对于分组统计的情形，你有时可能希望运行如下命令：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ss">&quot;Total Slots&quot;</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span>
<span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span>
<span class="w">        </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>通过运行上述指令，你会发现 PostgreSQL 提供了如下报错：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">ERROR</span><span class="p">:</span><span class="w"> </span><span class="k">aggregate</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">WHERE</span>
<span class="w">  </span><span class="k">Position</span><span class="p">:</span><span class="w"> </span><span class="mi">76</span>

<span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">was</span><span class="p">:</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ss">&quot;Total Slots&quot;</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span>
<span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span>
<span class="w">        </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>这是因为 PostgreSQL 不允许在 <code>WHERE</code> 中运行 <code>Aggregates</code> 相关的函数。取而代之的，你可以通过 <code>HAVING</code> 达成相似的目的：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ss">&quot;Total Slots&quot;</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span>
<span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span>
<span class="w">        </span><span class="k">having</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">        </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p>The behaviour of HAVING is easily confused with that of WHERE. The best way to think about it is that in the context of a query with an aggregate function, WHERE is used to filter what data gets input into the aggregate function, while HAVING is used to filter the data once it is output from the function. Try experimenting to explore this difference!</p>
<p>HAVING 的行为很容易与 WHERE 的行为混淆。最好的思考方式是，在具有聚合函数的查询上下文中， WHERE 用于过滤输入到聚合函数中的数据，而 HAVING 用于过滤从函数输出的数据。尝试尝试探索这种差异！</p>
</blockquote>
<h4 id="ctes">CTEs<a class="headerlink" href="#ctes" title="Permanent link">&para;</a></h4>
<p>这里我们看这个一个例子（<a href="https://pgexercises.com/questions/aggregates/fachours2.html">Aggregates.Q11</a>）:</p>
<ul>
<li>Output the facility id that has the highest number of slots booked. (输出预订 slots 数最多的设施)</li>
</ul>
<p>在已经有 <code>GROUP</code> 的情况下，使用 <code>LIMIT</code> 和 <code>ORDER</code> 固然可以很轻松地实现，但让我们来看看不用 <code>LIMIT</code> 的版本：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">totalslots</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span>
<span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span>
<span class="w">    </span><span class="k">having</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">sum2</span><span class="p">.</span><span class="n">totalslots</span><span class="p">)</span><span class="w"> </span><span class="k">from</span>
<span class="w">        </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">totalslots</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span>
<span class="w">        </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sum2</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>这是有关子查询（Subqueries）的一个极好的例子，同时也很好体现了 <code>GROUP</code> 如何结合 <code>HAVING</code>，又如何造成了查询上的不便局面。</p>
<p>值得一提的是，PostgreSQL 还提供了 <a href="https://www.postgresql.org/docs/current/static/queries-with.html">Common Table Expressions</a>(CTEs) 的概念，CTEs 可以被理解成 PostgreSQL 允许您在查询中内联定义数据库视图，然后像使用宏一样去使用它。</p>
<p>CTE 以 的形式 WITH CTEName as (SQL-Expression) 声明。您可以在下面看到我们的查询重新定义以使用 CTE：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">with</span><span class="w"> </span><span class="k">sum</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">totalslots</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span>
<span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">facid</span>
<span class="p">)</span>
<span class="k">select</span><span class="w"> </span><span class="n">facid</span><span class="p">,</span><span class="w"> </span><span class="n">totalslots</span><span class="w"> </span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="k">sum</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">totalslots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">totalslots</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">sum</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>这既美化了代码风格，又提高了可读性。</p>
<h4 id="more-about">More About<a class="headerlink" href="#more-about" title="Permanent link">&para;</a></h4>
<p>这里最后讲一个 PostgreSQL 提供的神奇特性：<code>Window Function</code>。</p>
<p>在 PostgreSQL 中，<code>Aggregates</code> 函数默认会导致聚合的结果，也就是一大堆输入的数据最后塌缩为一个数据。反过来，当我们不希望折叠数据时，我们可以在 <code>Aggregates</code> 函数后加上 <code>over</code>，并用 <code>partition</code> 指定分组依据（类似 <code>group</code>）。比如下面这个例子：</p>
<ul>
<li><a href="https://pgexercises.com/questions/aggregates/countmembers.html">Produce a list of member names, with each row containing the total member count</a></li>
</ul>
<p>但是产生一堆一样的值其实没有太大的用处，<code>Window Function</code> 更大的用处在于不分组的情况下产生与分组有关的信息，以及对 <code>rank()</code> 的支持：</p>
<ul>
<li>
<p>输出会员名单与该会员在其加入当月的位次。
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">date_trunc</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">joindate</span><span class="p">)</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">joindate</span><span class="p">),</span>
<span class="w">  </span><span class="n">firstname</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span>
<span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">joindate</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>按四舍五入后的时间对成员排序。
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">firstname</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span><span class="p">,</span>
<span class="w">  </span><span class="p">((</span><span class="k">sum</span><span class="p">(</span><span class="n">bks</span><span class="p">.</span><span class="n">slots</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">hours</span><span class="p">,</span>
<span class="w">  </span><span class="n">rank</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="p">((</span><span class="k">sum</span><span class="p">(</span><span class="n">bks</span><span class="p">.</span><span class="n">slots</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rank</span>

<span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">bookings</span><span class="w"> </span><span class="n">bks</span>
<span class="w">  </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span><span class="w"> </span><span class="n">mems</span>
<span class="w">      </span><span class="k">on</span><span class="w"> </span><span class="n">bks</span><span class="p">.</span><span class="n">memid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">memid</span>
<span class="w">  </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">mems</span><span class="p">.</span><span class="n">memid</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span><span class="p">,</span><span class="w"> </span><span class="n">firstname</span><span class="p">;</span><span class="w">  </span>
</code></pre></div></td></tr></table></div></p>
</li>
</ul>
<p>更多有趣的机制，比如 <code>Recursive Queries</code>，大家可以自行去 <a href="https://pgexercises.com/questions/recursive/">PostgreSQL Exercises</a> 学习与练习。</p>
<h3 id="explain">EXPLAIN<a class="headerlink" href="#explain" title="Permanent link">&para;</a></h3>
<p>你可能关心查询是如何被数据库执行的，这是可以使用 <code>EXPLAIN ANALYZE</code>，让 MySQL 打印执行计划，例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">ANALYZE</span>
<span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">over</span><span class="p">(</span><span class="k">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">date_trunc</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">joindate</span><span class="p">)</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">joindate</span><span class="p">),</span>
<span class="w">    </span><span class="n">firstname</span><span class="p">,</span><span class="w"> </span><span class="n">surname</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">cd</span><span class="p">.</span><span class="n">members</span>
<span class="w">  </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">joindate</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h3 id="orm">ORM<a class="headerlink" href="#orm" title="Permanent link">&para;</a></h3>
<p>在我们实际开发中，通常会直接使用成熟的后端框架来操作数据库，例如 Django 等，在这些框架中，你无需手写 SQL 语句，而可以直接使用它的 ORM 框架（或者其他框架）。</p>
<p>ORM 全称为 Objected Relational Mapping，其构造了数据库对象与 Python 对象中的如下映射：</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>TABLE -&gt; Class
Record -&gt; Instance（实例）
Column -&gt; Attribute（属性）
</code></pre></div></td></tr></table></div>
实际上，ORM 在执行操作时依然会将对应的操作转换成数据库原生语句，但是其拥有如下优点：</p>
<ul>
<li><strong>提高开发效率</strong>：开发者可以直接操作对象，无需编写繁琐的 SQL 语句，代码更简洁易读。</li>
<li><strong>跨数据库兼容性</strong>：ORM 屏蔽了底层数据库的差异，切换数据库时通常只需修改配置，无需重写大量代码。</li>
<li><strong>类型安全与自动校验</strong>：ORM 能根据模型定义自动校验数据类型和约束，减少运行时错误。</li>
<li><strong>防止 SQL 注入</strong>：ORM 默认采用参数化查询，能有效防止 SQL 注入等安全问题。</li>
<li><strong>便于维护和重构</strong>：数据表结构变更时，只需修改模型类，维护成本低，易于重构。</li>
<li><strong>支持复杂查询和关联</strong>：ORM 支持对象之间的关联关系（如一对多、多对多），并能方便地进行复杂查询和数据操作。</li>
</ul>
<p>除了 Django 提供的 ORM 框架外，不同编程语言也有其他的 ORM 框架：</p>
<ul>
<li>Python：<a href="https://www.sqlalchemy.org/">SQLAlchemy</a></li>
<li>Rust：<a href="https://diesel.rs/">Diesel</a>、<a href="https://www.sea-ql.org/SeaORM/">SeaORM</a></li>
<li>Node.js：<a href="https://sequelize.org/">Sequelize</a>、<a href="https://typeorm.io/">TypeORM</a>；</li>
<li>Java：<a href="https://hibernate.org/">Hibernate</a>；</li>
<li>Go：<a href="https://gorm.io/">GORM</a>。</li>
</ul>
<h4 id="orm_1">常见 ORM 使用示例<a class="headerlink" href="#orm_1" title="Permanent link">&para;</a></h4>
<p><strong>1. Django ORM 示例（使用 SQLite）</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># models.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>

<span class="c1"># 创建数据</span>
<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># 查询数据</span>
<span class="n">students</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">age__gte</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="c1"># 更新数据</span>
<span class="n">student</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">student</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1"># 删除数据</span>
<span class="n">student</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. Node.js 使用 Mongoose 操作 MongoDB</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// models/student.js</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">mongoose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">studentSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">  </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span>
<span class="p">});</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">Student</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Student&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">studentSchema</span><span class="p">);</span>

<span class="c1">// 创建数据</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">student</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Student</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">22</span><span class="w"> </span><span class="p">});</span>
<span class="k">await</span><span class="w"> </span><span class="nx">student</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>

<span class="c1">// 查询数据</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">students</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Student</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gte</span><span class="o">:</span><span class="w"> </span><span class="mf">18</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>

<span class="c1">// 更新数据</span>
<span class="nx">student</span><span class="p">.</span><span class="nx">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">23</span><span class="p">;</span>
<span class="k">await</span><span class="w"> </span><span class="nx">student</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>

<span class="c1">// 删除数据</span>
<span class="k">await</span><span class="w"> </span><span class="nx">Student</span><span class="p">.</span><span class="nx">deleteOne</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bob&#39;</span><span class="w"> </span><span class="p">});</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. Rust 使用 Diesel 操作 PostgreSQL</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// models.rs</span>
<span class="k">use</span><span class="w"> </span><span class="n">diesel</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">diesel</span><span class="p">::</span><span class="n">pg</span><span class="p">::</span><span class="n">PgConnection</span><span class="p">;</span>

<span class="cp">#[derive(Queryable, Insertable)]</span>
<span class="cp">#[table_name = </span><span class="s">&quot;students&quot;</span><span class="cp">]</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Student</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// 插入数据</span>
<span class="kd">let</span><span class="w"> </span><span class="n">new_student</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Student</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Carol&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="p">};</span>
<span class="n">diesel</span><span class="p">::</span><span class="n">insert_into</span><span class="p">(</span><span class="n">students</span><span class="p">::</span><span class="n">table</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">values</span><span class="p">(</span><span class="o">&amp;</span><span class="n">new_student</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conn</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="c1">// 查询数据</span>
<span class="kd">let</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">students</span><span class="p">::</span><span class="n">table</span>
<span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">students</span><span class="p">::</span><span class="n">age</span><span class="p">.</span><span class="n">ge</span><span class="p">(</span><span class="mi">18</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="n">load</span><span class="p">::</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conn</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="c1">// 更新数据</span>
<span class="n">diesel</span><span class="p">::</span><span class="n">update</span><span class="p">(</span><span class="n">students</span><span class="p">::</span><span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">students</span><span class="p">::</span><span class="n">age</span><span class="p">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conn</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="c1">// 删除数据</span>
<span class="n">diesel</span><span class="p">::</span><span class="n">delete</span><span class="p">(</span><span class="n">students</span><span class="p">::</span><span class="n">table</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">execute</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conn</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 使用 ORM 连接服务器类型数据库的示例（以 Python SQLAlchemy 连接 PostgreSQL 为例）</strong></p>
<p>ORM 框架不仅支持本地文件型数据库（如 SQLite），也能方便地连接远程服务器类型数据库（如 PostgreSQL、MySQL）。只需更换数据库连接字符串即可。例如，使用 SQLAlchemy 连接远程 PostgreSQL：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">declarative_base</span><span class="p">,</span> <span class="n">sessionmaker</span>

<span class="c1"># 连接远程 PostgreSQL 数据库</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://username:password@host:5432/dbname&quot;</span><span class="p">)</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;students&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="c1"># 创建数据</span>
<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;David&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">student</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># 查询数据</span>
<span class="n">students</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Student</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Student</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>这种方式可以轻松切换本地与远程数据库，适用于生产环境下多用户并发访问和大规模数据存储的需求。</p>
<h3 id="sql_2">SQL 注入<a class="headerlink" href="#sql_2" title="Permanent link">&para;</a></h3>
<p>SQL 注入攻击（SQL Injection）是一种网络攻击手段，攻击者通过在输入字段中插入恶意的 SQL 代码来操纵数据库，从而访问、修改或删除数据。攻击的目标通常是那些没有对用户输入进行适当验证和过滤的 Web 应用程序。</p>
<h4 id="_13">基本原理<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p>SQL 注入的发生本质上来源于程序设计中对 SQL 语言使用时的设计缺陷。考虑如下情形，假设有一个登录功能，其 SQL 查询如下：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>如果用户输入的 <code>username</code> 为 <code>' OR '1'='1</code>，则生成的SQL查询变为：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;pass&#39;</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>由于 <code>'1'='1'</code> 总是为真，这个查询将绕过验证，导致攻击者可以登录系统。</p>
<h4 id="_14">预防措施<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<ul>
<li>对数据进行转义，永远不要信任用户的输入，要对用户的输入进行校验，可以通过正则表达式，或限制长度，对单引号和双”-“进行转换等；</li>
<li>永远不要使用动态拼装 SQL，可以使用参数化的 SQL 或者直接使用存储过程进行数据查询存取；</li>
<li>不要把机密信息明文存放，请加密或者 hash 掉密码和敏感的信息；</li>
<li>使用 ORM（对象关系映射）。</li>
</ul>
<h2 id="_15">参考资料<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<ul>
<li>PostgreSQL 官方文档: <a href="https://www.postgresql.org/docs/">https://www.postgresql.org/docs/</a></li>
<li>PostgreSQL Exercises: <a href="https://pgexercises.com">https://pgexercises.com</a></li>
<li>酒井科协 &amp; 算协联合暑培 2024【数据库 &amp; SQL】课程讲义 by Andonade: <a href="https://summer24.net9.org/basic/sql/handout/">https://summer24.net9.org/basic/sql/handout/</a></li>
<li>酒井科协暑培 2023 数据库 &amp; SQL by 刘铠铭 @kaiming: <a href="https://summer23.net9.org/basic/sql/#523-count-max-min-sum-avg">https://summer23.net9.org/basic/sql/#523-count-max-min-sum-avg</a></li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025年8月10日 11:39:12 UTC">2025年8月10日</span>
  </span>

    
    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="贡献者">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:2145988604@qq.com">kjcKen</a>
    </nav>
  </span>

    
    
  </aside>




<h2 id="__comments">评论</h2>
<!-- Insert generated snippet here -->
<script src="https://giscus.app/client.js"
        data-repo="sast-summer-training-2025/sast-summer-training-2025.github.io"
        data-repo-id="R_kgDOPPTXEQ"
        data-category="Announcements"
        data-category-id="DIC_kwDOPPTXEc4CtLfQ"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>

<!-- Synchronize Giscus theme with palette -->
<script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        giscus.setAttribute("data-theme", theme)
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function () {
        var ref = document.querySelector("[data-md-component=palette]")
        ref.addEventListener("change", function () {
            var palette = __md_get("__palette")
            if (palette && typeof palette.color === "object") {
                var theme = palette.color.scheme === "slate" ? "dark" : "light"

                /* Instruct Giscus to change theme */
                var frame = document.querySelector(".giscus-frame")
                frame.contentWindow.postMessage(
                    { giscus: { setConfig: { theme } } },
                    "https://giscus.app"
                )
            }
        })
    })
</script>
                
    
        <div class="md-source-date">
            <small>
                作者: <span class='git-page-authors git-authors'><a href='mailto:2145988604@qq.com'>kjcKen</a></span>
            </small>
        </div>
    

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "navigation.top", "navigation.tabs", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
    
      <script src="../../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.1.0/dist/mermaid.min.js"></script>
      
    
    <script type="text/javascript">
        document.querySelectorAll('a[href^="http"]').forEach(link => {
            link.setAttribute('referrerpolicy', 'no-referrer');
            link.setAttribute('target', '_blank');
        });
    </script>

  </body>
</html>